<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Fetch Example with Form</title>
  </head>
  <body>
    <h1>Product Search</h1>
    <form id="apiForm">
      <label for="param1">sectid:</label>
      <input type="text" id="param1" name="param1" value="value1" />
      <br />
      <label for="param2">email:</label>
      <input type="text" id="param2" name="param2" value="value2" />
      <br />
      <button type="button" onclick="makeApiRequest()">API 요청 보내기</button>
    </form>

    <div id="resultContainer"></div>
    <br />
    <div id="countContainer"></div>

    <script>
      // API 요청 메서드
      function mainApiRequet() {
        // API 엔드포인트 설정 (로컬 호스트에 맞게 수정해주세요)
        var apiUrl = 'http://localhost:5000/productExtract';

        // 폼 요소 가져오기
        var form = document.getElementById('apiForm');

        // 폼의 파라미터 값 가져오기
        var sectid = form.elements.param1.value;
        var email = form.elements.param2.value;

        // main Url 완성하기
        var mainUrl = 'https://www.gsshop.com/shop/sect/sectM.gs?sectid=';
        mainUrl.concat(sectid);

        // 보낼 파라미터 설정
        var params = {
          mainUrl: mainUrl,
        };

        // URL에 파라미터 추가
        var urlWithParams = new URL(apiUrl);
        urlWithParams.search = new URLSearchParams(params).toString();
      }

      function makeApiRequest() {
        // API 엔드포인트 설정 (로컬 호스트에 맞게 수정해주세요)
        var apiUrl = 'http://localhost:5000/extract';

        // 폼 요소 가져오기
        var form = document.getElementById('apiForm');

        // 폼의 파라미터 값 가져오기
        var param1 = form.elements.param1.value;
        var param2 = form.elements.param2.value;

        // 보낼 파라미터 설정
        var params = {
          sectid: param1,
          email: param2,
        };

        // URL에 파라미터 추가
        var urlWithParams = new URL(apiUrl);
        urlWithParams.search = new URLSearchParams(params).toString();

        // fetch를 사용하여 API에 GET 요청 보내기
        fetch(urlWithParams)
          .then((response) => {
            // 응답이 성공적인지 확인
            if (!response.ok) {
              throw new Error('네트워크 오류');
            }
            // JSON 형태로 응답 데이터 파싱
            return response.json();
          })
          .then((data) => {
            // 성공적으로 데이터를 받아왔을 때의 처리
            console.log('API 응답:', data);

            // 결과를 동적으로 생성한 HTML로 출력
            var resultHtml = '<p>API 응답:</p>';
            resultHtml += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            resultContainer.innerHTML = resultHtml;
          })
          .catch((error) => {
            // 오류가 발생했을 때의 처리
            console.error('API 오류:', error.message);

            // 오류 메시지를 동적으로 생성한 HTML로 출력
            var errorHtml = '<p>API 오류:</p>';
            errorHtml += '<p>' + error.message + '</p>';
            resultContainer.innerHTML = errorHtml;
          });
      }

      function secondCountApiRequest() {
        for (var i = 1; i <= 10; i++) {
          setTimeout(function () {
            //console.log(number);
            countHtml += '<p>' + i + '</p>';
            countContainer.innerHTML = countHtml;
          }, 1000); // 1초씩 딜레이
        }
      }
    </script>
  </body>
</html>
